<!--
  Render the "Revisions" row of the performance report as JSON

  Parameters
    $.prpt            Participant Key
    $.data            Site Data  
    $.scratch         Scratchpad ref
    $.avg_cols        The averages columns to render in the rows, or nil if not applicable
    $.weeks           The Weeks for which to render the rows
-->
{{- $row_map_key := "report_row" -}}
{{- $prpt_rpts := index $.data.Measures.Weekly $.prpt -}}

{{- $.scratch.Delete $row_map_key -}}
{{- $.scratch.SetInMap $row_map_key "isHeadingRow" true -}} <!-- Well, not exactly a "heading", but the easiest way to handle this one-off "Revisions" use-case -->
{{- $.scratch.SetInMap $row_map_key "isSubheading" true -}} <!-- ...and we have to mark this is a "sub-heading" to prevent row selection for quick graphs -->
{{- $.scratch.SetInMap $row_map_key "rowLabel" "Revisions" -}}
{{- $.scratch.SetInMap $row_map_key "key" "Revisions" -}}
{{- range $.avg_cols -}}
  {{- $.scratch.SetInMap $row_map_key .Key "" -}}
{{- end -}}
{{- range $week := $.weeks -}}
  {{- $prpt_rpt := index $prpt_rpts $week.Key -}}
  {{- with $prpt_rpt -}}
    {{- $revisions := index . "Revisions" -}}
    {{- $.scratch.SetInMap $row_map_key $week.Key (cond (eq $revisions true) "R" "") -}}
  {{- end -}}
{{- end -}}

{{- "\n\t " -}}{{- $.scratch.Get $row_map_key | jsonify -}}
