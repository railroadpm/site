<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="icon" type="image/jpg" href="/favicon-rpm-32x32.jpg" sizes="32x32">
  <title>RPM Admin</title>
  <!-- Include the styles for customizing Netlify CMS UI -->
  <link rel="stylesheet" href="main.css">
  <!-- We need the Netlify Identity Widget -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>

<body>
  <!--
    Include the script that builds the page and powers Netlify CMS...

    Note:
      We use a custom build of the CMS. To pull the latest version/build of our
      custom code you want to execute the following from the command-line while
      your *current working directory* is set to this "/admin" folder...

        > yarn build
  -->
  <script src="rrpm-netlify-cms.js"></script>

  <script>
    if (window.netlifyIdentity) {
      window.netlifyIdentity.on("init", function(user) {
        // console.log(">>> Netlify Identity: In Init Event Handler", user);
        if (!user) {
          window.netlifyIdentity.on("login", function() {
            // console.log(">>> Netlify Identity: In Login Event Handler");
            document.location.href = "/";
          });
        } else {
          // console.log(">>> Netlify Identity: User Is Logged In", JSON.stringify(user));
          let ncRoot = document.getElementById("nc-root");
          if (user.app_metadata && user.app_metadata.roles && ncRoot) {
            const roles = user.app_metadata.roles;

            if (roles.includes('Administrator')) ncRoot.classList.add("nc-user-role-is-admin");
            else ncRoot.classList.add("nc-user-role-is-participant");

            if (roles.includes('BNSF')) ncRoot.classList.add("nc-user-role-is-bnsf");
            if (roles.includes('CN')) ncRoot.classList.add("nc-user-role-is-cn");
            if (roles.includes('KCS')) ncRoot.classList.add("nc-user-role-is-kcs");
            if (roles.includes('NS')) ncRoot.classList.add("nc-user-role-is-ns");
            if (roles.includes('UP')) ncRoot.classList.add("nc-user-role-is-up");
          }
        }
      });
    }
  </script>
</body>

</html>
